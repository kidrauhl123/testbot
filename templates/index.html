<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>YouTubeå……å€¼ç³»ç»Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- æ·»åŠ Font Awesomeå›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Microsoft YaHei', Arial, sans-serif; 
      background-color: #f8f9fa;
      margin: 0; padding: 0; min-height: 100vh;
      color: #333;
      font-size: 14px;
      overflow-y: auto;
    }
    
    /* è‡ªå®šä¹‰æç¤ºæ¡†æ ·å¼ */
    .custom-alert {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      z-index: 9999;
      font-size: 14px;
      display: flex;
      align-items: center;
      min-width: 300px;
      max-width: 80%;
      animation: slideDown 0.3s ease-out;
    }
    
    .custom-alert.success {
      background: #ffffff;
      color: #28a745;
      border-left: 4px solid #28a745;
    }
    
    .custom-alert.warning {
      background: #ffffff;
      color: #ffc107;
      border-left: 4px solid #ffc107;
    }
    
    .custom-alert.error {
      background: #ffffff;
      color: #dc3545;
      border-left: 4px solid #dc3545;
    }
    
    .custom-alert-icon {
      margin-right: 10px;
      font-size: 18px;
    }
    
    .custom-alert-close {
      margin-left: auto;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .custom-alert-close:hover {
      opacity: 1;
    }
    
    @keyframes slideDown {
      0% {
        transform: translate(-50%, -20px);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    .navbar {
      background: #ffffff;
      padding: 15px 20px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.03);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .navbar-brand {
      font-size: 18px;
      font-weight: 600;
      color: #4a4a4a;
      display: flex;
      align-items: center;
    }
    .navbar-brand::before {
      content: 'ğŸ“º';
      margin-right: 8px;
      font-size: 20px;
    }
    
    .btn {
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    .btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    }
    .btn-primary { 
      background: #4d7cfe; 
      color: white; 
    }
    .btn-danger { 
      background: #ff6b6b; 
      color: white; 
    }
    
    .main-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.03);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid rgba(0,0,0,0.02);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .card-header h2 {
      margin: 0;
      font-weight: 600;
      font-size: 18px;
      color: #4a4a4a;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border-radius: 6px;
      border: 1px solid #e1e5eb;
      background: white;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .form-control:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(77,124,254,0.2);
      border-color: #4d7cfe;
    }
    
    /* äºŒç»´ç ä¸Šä¼ åŒºåŸŸ */
    .qr-upload-area {
      width: 100%;
      height: 240px;
      border: 2px dashed #e1e5eb;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: #fafbfc;
      position: relative;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .qr-upload-area:hover {
      border-color: #4d7cfe;
      background: rgba(77,124,254,0.02);
    }
    
    .qr-upload-icon {
      font-size: 40px;
      color: #a1a8b2;
      margin-bottom: 15px;
    }
    
    .qr-upload-text {
      font-size: 14px;
      color: #677788;
      text-align: center;
      padding: 0 20px;
      line-height: 1.5;
    }
    
    .qr-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 15px;
      background: white;
    }
    
    .qr-upload-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
    }
    
    .qr-upload-area:hover .qr-upload-actions {
      display: block;
    }
    
    .qr-upload-remove {
      background: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      transition: all 0.2s ease;
    }
    
    .qr-upload-remove:hover {
      background: #ff6b6b;
      color: white;
    }
    
    /* è®¢å•è¡¨æ ¼ */
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .orders-table th, .orders-table td {
      padding: 14px 15px;
      text-align: left;
      border-bottom: 1px solid #e1e5eb;
    }
    
    .orders-table thead th {
      font-weight: 600;
      color: #555;
      background: #fafbfc;
    }
    
    .orders-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-submitted {
      background-color: #e8f4fd;
      color: #3498db;
    }
    
    .status-paid {
      background-color: #fef8e6;
      color: #f1c40f;
    }
    
    .status-confirmed {
      background-color: #e8f7f0;
      color: #2ecc71;
    }
    
    .status-failed {
      background-color: #feeae9;
      color: #e74c3c;
    }
    
    .status-need_new_qr {
      background-color: #f1e9f7;
      color: #9b59b6;
    }
    
    /* å“åº”å¼é€‚é… */
    @media (max-width: 768px) {
      .card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="navbar-brand">YouTubeå……å€¼ç³»ç»Ÿ</div>
  </div>
  
  <div class="main-container">
    <div class="card">
      <div class="card-header">
        <h2>åˆ›å»ºå……å€¼è®¢å•</h2>
      </div>
      <div class="card-body">
        <form id="order-form">
          <div class="form-group">
            <label class="form-label">æ‚¨çš„æ˜µç§°ï¼ˆé€‰å¡«ï¼‰</label>
            <input type="text" class="form-control" name="customer_name" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°ï¼Œæ–¹ä¾¿è¯†åˆ«è®¢å•">
          </div>
          
          <!-- éšè—å¥—é¤å­—æ®µï¼Œä½¿ç”¨é»˜è®¤å€¼ -->
          <input type="hidden" name="package" value="default">
          
          <div class="form-group">
            <label class="form-label">ä¸Šä¼ YouTubeäºŒç»´ç </label>
            <div class="qr-upload-area" id="qr-upload-area">
              <div class="qr-upload-icon">
                <i class="fas fa-qrcode"></i>
              </div>
              <div class="qr-upload-text">
                ç‚¹å‡»ä¸Šä¼ äºŒç»´ç å›¾ç‰‡ï¼Œæˆ–è€…å°†å›¾ç‰‡æ‹–æ”¾åˆ°æ­¤å¤„<br>
                <small>æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå¯ä»¥ç›´æ¥ç²˜è´´å›¾ç‰‡</small>
              </div>
              <img id="qr-preview" class="qr-preview" style="display: none;">
              <div class="qr-upload-actions">
                <button type="button" class="qr-upload-remove" id="qr-upload-remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <input type="file" id="qr-file" style="display: none;" accept="image/*">
            <input type="hidden" name="qr_image_data" id="qr-image-data">
          </div>
          
          <div class="form-group">
            <button type="submit" class="btn btn-primary" style="width: 100%;">
              <i class="fas fa-paper-plane"></i> æäº¤è®¢å•
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2>è®¢å•æŸ¥è¯¢</h2>
      </div>
      <div class="card-body">
        <div class="form-group">
          <label class="form-label">è¾“å…¥è®¢å•å·æŸ¥è¯¢çŠ¶æ€</label>
          <div style="display: flex; gap: 10px;">
            <input type="text" class="form-control" id="order-id-input" placeholder="è¯·è¾“å…¥è®¢å•å·">
            <button type="button" class="btn btn-primary" id="check-order-btn" style="white-space: nowrap;">
              <i class="fas fa-search"></i> æŸ¥è¯¢
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- è®¢å•çŠ¶æ€æŸ¥è¯¢æ¨¡æ€æ¡†ï¼Œä¿ç•™åŸä»£ç  -->
  <div id="order-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999; overflow-y: auto;">
    <div style="background: white; max-width: 600px; margin: 40px auto; padding: 30px; border-radius: 12px; position: relative; animation: fadeIn 0.3s ease-out;">
      <button type="button" id="close-modal" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
      <div id="order-details"></div>
    </div>
  </div>
  
  <script>
    // ä¿æŒåŸæœ‰JavaScriptä»£ç ï¼Œä½†éœ€è¦ä¿®æ”¹è¡¨å•æäº¤éƒ¨åˆ†ï¼Œä¸å†éœ€è¦å¥—é¤é€‰æ‹©
    document.addEventListener('DOMContentLoaded', function() {
      const qrUploadArea = document.getElementById('qr-upload-area');
      const qrFileInput = document.getElementById('qr-file');
      const qrPreview = document.getElementById('qr-preview');
      const qrImageData = document.getElementById('qr-image-data');
      const qrRemoveBtn = document.getElementById('qr-upload-remove');
      const orderForm = document.getElementById('order-form');
      const checkOrderBtn = document.getElementById('check-order-btn');
      const orderIdInput = document.getElementById('order-id-input');
      const orderModal = document.getElementById('order-modal');
      const closeModal = document.getElementById('close-modal');
      const orderDetails = document.getElementById('order-details');
      
      // QRä¸Šä¼ ç›¸å…³å‡½æ•°
      qrUploadArea.addEventListener('click', function() {
        qrFileInput.click();
      });
      
      qrFileInput.addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
          handleQrImage(e.target.files[0]);
        }
      });
      
      qrRemoveBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        qrPreview.style.display = 'none';
        qrImageData.value = '';
        qrFileInput.value = '';
      });
      
      // æ‹–æ”¾ä¸Šä¼ 
      qrUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        qrUploadArea.style.borderColor = '#4d7cfe';
        qrUploadArea.style.background = 'rgba(77,124,254,0.05)';
      });
      
      qrUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        qrUploadArea.style.borderColor = '#e1e5eb';
        qrUploadArea.style.background = '#fafbfc';
      });
      
      qrUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        qrUploadArea.style.borderColor = '#e1e5eb';
        qrUploadArea.style.background = '#fafbfc';
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          handleQrImage(e.dataTransfer.files[0]);
        }
      });
      
      // ç²˜è´´ä¸Šä¼ 
      document.addEventListener('paste', function(e) {
        if (e.clipboardData && e.clipboardData.items) {
          const items = e.clipboardData.items;
          for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
              const blob = items[i].getAsFile();
              handleQrImage(blob);
              break;
            }
          }
        }
      });
      
      function handleQrImage(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          qrPreview.src = e.target.result;
          qrPreview.style.display = 'block';
          qrImageData.value = e.target.result;
        };
        reader.readAsDataURL(file);
      }
      
      // è¡¨å•æäº¤
      orderForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // éªŒè¯è¡¨å•
        if (!qrImageData.value) {
          showAlert('è¯·ä¸Šä¼ äºŒç»´ç å›¾ç‰‡', 'warning');
          return;
        }
        
        // æ”¶é›†è¡¨å•æ•°æ®
        const formData = new FormData(orderForm);
        
        // æäº¤è¡¨å•
        fetch('/submit_order', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showAlert('è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•å·: ' + data.order_id, 'success');
            // é‡ç½®è¡¨å•
            orderForm.reset();
            qrPreview.style.display = 'none';
            qrImageData.value = '';
          } else {
            showAlert('è®¢å•åˆ›å»ºå¤±è´¥: ' + data.message, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('æäº¤è®¢å•æ—¶å‘ç”Ÿé”™è¯¯', 'error');
        });
      });
      
      // æŸ¥è¯¢è®¢å•
      checkOrderBtn.addEventListener('click', function() {
        const orderId = orderIdInput.value.trim();
        if (!orderId) {
          showAlert('è¯·è¾“å…¥è®¢å•å·', 'warning');
          return;
        }
        
        fetch(`/check_order/${orderId}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              showOrderDetails(data.order);
            } else {
              showAlert('æŸ¥è¯¢è®¢å•å¤±è´¥: ' + data.message, 'error');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showAlert('æŸ¥è¯¢è®¢å•æ—¶å‘ç”Ÿé”™è¯¯', 'error');
          });
      });
      
      // æ˜¾ç¤ºè®¢å•è¯¦æƒ…æ¨¡æ€æ¡†
      function showOrderDetails(order) {
        // æ„å»ºè®¢å•è¯¦æƒ…HTML
        let statusClass = '';
        switch(order.status) {
          case 'SUBMITTED': statusClass = 'status-submitted'; break;
          case 'PAID': statusClass = 'status-paid'; break;
          case 'CONFIRMED': statusClass = 'status-confirmed'; break;
          case 'FAILED': statusClass = 'status-failed'; break;
          case 'NEED_NEW_QR': statusClass = 'status-need_new_qr'; break;
        }
        
        // å°†çŠ¶æ€ç¿»è¯‘ä¸ºä¸­æ–‡
        let statusText = '';
        switch(order.status) {
          case 'SUBMITTED': statusText = 'å·²æäº¤'; break;
          case 'PAID': statusText = 'å·²æ”¯ä»˜'; break;
          case 'CONFIRMED': statusText = 'å·²ç¡®è®¤'; break;
          case 'FAILED': statusText = 'å¤±è´¥'; break;
          case 'NEED_NEW_QR': statusText = 'éœ€è¦æ–°äºŒç»´ç '; break;
          default: statusText = order.status;
        }
        
        let html = `
          <h2 style="margin-top: 0; font-size: 18px;">è®¢å•è¯¦æƒ… #${order.id}</h2>
          <div style="margin-bottom: 20px;">
            <span class="status-badge ${statusClass}" style="margin-right: 10px;">${statusText}</span>
            <span style="font-size: 12px; color: #888;">åˆ›å»ºæ—¶é—´: ${order.created_at}</span>
          </div>
        `;
        
        // å¦‚æœæœ‰å®¢æˆ·åç§°
        if (order.customer_name) {
          html += `<p><strong>å®¢æˆ·åç§°:</strong> ${order.customer_name}</p>`;
        }
        
        // å¦‚æœæœ‰æ¶ˆæ¯
        if (order.message) {
          html += `
            <div style="margin-top: 15px; padding: 15px; background: #f7f7f7; border-radius: 6px;">
              <p style="margin: 0; font-size: 13px;"><strong>å¤„ç†æ¶ˆæ¯:</strong><br>${order.message.replace(/\n/g, '<br>')}</p>
            </div>
          `;
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        orderDetails.innerHTML = html;
        orderModal.style.display = 'block';
        document.body.style.overflow = 'hidden';
      }
      
      // å…³é—­æ¨¡æ€æ¡†
      closeModal.addEventListener('click', function() {
        orderModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      });
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨ä¹Ÿå¯ä»¥å…³é—­
      orderModal.addEventListener('click', function(e) {
        if (e.target === orderModal) {
          orderModal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      });
      
      // è‡ªå®šä¹‰æç¤ºæ¡†
      function showAlert(message, type = 'info') {
        const alertDiv = document.createElement('div');
        alertDiv.className = `custom-alert ${type}`;
        
        let icon = '';
        switch(type) {
          case 'success': icon = '<i class="fas fa-check-circle"></i>'; break;
          case 'warning': icon = '<i class="fas fa-exclamation-triangle"></i>'; break;
          case 'error': icon = '<i class="fas fa-times-circle"></i>'; break;
          default: icon = '<i class="fas fa-info-circle"></i>';
        }
        
        alertDiv.innerHTML = `
          <div class="custom-alert-icon">${icon}</div>
          <div>${message}</div>
          <div class="custom-alert-close">&times;</div>
        `;
        
        document.body.appendChild(alertDiv);
        
        // è‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
          alertDiv.style.opacity = '0';
          alertDiv.style.transform = 'translate(-50%, -20px)';
          setTimeout(() => alertDiv.remove(), 300);
        }, 3000);
        
        // ç‚¹å‡»å…³é—­
        alertDiv.querySelector('.custom-alert-close').addEventListener('click', () => {
          alertDiv.style.opacity = '0';
          alertDiv.style.transform = 'translate(-50%, -20px)';
          setTimeout(() => alertDiv.remove(), 300);
        });
      }
    });
  </script>
</body>
</html> 