<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>è®¢å•çŠ¶æ€ - YouTubeå……å€¼ç³»ç»Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- æ·»åŠ Font Awesomeå›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Microsoft YaHei', Arial, sans-serif; 
      background: linear-gradient(135deg, #FF0000 0%, #FF5E00 100%);
      margin: 0; padding: 0; min-height: 100vh;
      color: #333;
      font-size: 14px;
      overflow-y: auto;
    }
    
    /* è‡ªå®šä¹‰æç¤ºæ¡†æ ·å¼ */
    .custom-alert {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      font-size: 14px;
      display: flex;
      align-items: center;
      min-width: 300px;
      max-width: 80%;
      animation: slideDown 0.3s ease-out;
    }
    
    .custom-alert.success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }
    
    .custom-alert.warning {
      background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
      color: #333;
    }
    
    .custom-alert.error {
      background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      color: white;
    }
    
    .custom-alert-icon {
      margin-right: 10px;
      font-size: 18px;
    }
    
    .custom-alert-close {
      margin-left: auto;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .custom-alert-close:hover {
      opacity: 1;
    }
    
    @keyframes slideDown {
      0% {
        transform: translate(-50%, -20px);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    .navbar {
      background: rgba(255,255,255,0.9);
      padding: 12px 20px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .navbar-brand {
      font-size: 18px;
      font-weight: bold;
      color: #FF0000;
      display: flex;
      align-items: center;
    }
    .navbar-brand::before {
      content: 'ğŸ“º';
      margin-right: 6px;
      font-size: 20px;
    }
    
    .btn {
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    .btn-primary { 
      background: linear-gradient(135deg, #FF0000 0%, #FF5E00 100%); 
      color: white; 
    }
    .btn-danger { 
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5253 100%); 
      color: white; 
    }
    
    .main-container {
      max-width: 800px;
      margin: 30px auto;
      padding: 0 20px;
    }
    
    .card {
      background: rgba(255,255,255,0.97);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid rgba(255,255,255,0.5);
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.18);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    
    .card-header h2 {
      margin: 0;
      font-weight: 600;
      font-size: 18px;
      background: linear-gradient(135deg, #FF0000 0%, #FF5E00 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .card-header h2::before {
      content: 'ğŸ“‹';
      margin-right: 8px;
      font-size: 18px;
    }
    
    .order-id {
      font-weight: 600;
      color: #555;
      font-size: 16px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .status-submitted {
      background-color: rgba(52, 152, 219, 0.1);
      color: #3498db;
    }
    
    .status-paid {
      background-color: rgba(241, 196, 15, 0.1);
      color: #f1c40f;
    }
    
    .status-confirmed {
      background-color: rgba(46, 204, 113, 0.1);
      color: #2ecc71;
    }
    
    .status-failed {
      background-color: rgba(231, 76, 60, 0.1);
      color: #e74c3c;
    }
    
    .status-need_new_qr {
      background-color: rgba(155, 89, 182, 0.1);
      color: #9b59b6;
    }
    
    .order-details {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .order-label {
      font-weight: 600;
      color: #555;
    }
    
    .order-value {
      color: #333;
    }
    
    .order-status-timeline {
      display: flex;
      justify-content: space-between;
      margin: 30px 0;
      position: relative;
    }
    
    .order-status-timeline::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: rgba(0,0,0,0.1);
      z-index: 1;
    }
    
    .timeline-step {
      position: relative;
      z-index: 2;
      text-align: center;
      width: 33.33%;
    }
    
    .timeline-dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: white;
      border: 2px solid rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .timeline-dot i {
      font-size: 14px;
      color: rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }
    
    .timeline-label {
      font-size: 12px;
      font-weight: 600;
      color: rgba(0,0,0,0.5);
      transition: all 0.3s ease;
    }
    
    .timeline-date {
      font-size: 11px;
      color: rgba(0,0,0,0.3);
      margin-top: 5px;
    }
    
    .timeline-step.active .timeline-dot {
      border-color: #FF5E00;
      background: #FF5E00;
    }
    
    .timeline-step.active .timeline-dot i {
      color: white;
    }
    
    .timeline-step.active .timeline-label {
      color: #FF5E00;
    }
    
    .timeline-step.completed .timeline-dot {
      border-color: #2ecc71;
      background: #2ecc71;
    }
    
    .timeline-step.completed .timeline-dot i {
      color: white;
    }
    
    .timeline-step.completed .timeline-label {
      color: #2ecc71;
    }
    
    .timeline-step.failed .timeline-dot {
      border-color: #e74c3c;
      background: #e74c3c;
    }
    
    .timeline-step.failed .timeline-dot i {
      color: white;
    }
    
    .timeline-step.failed .timeline-label {
      color: #e74c3c;
    }
    
    .order-message {
      background: rgba(0,0,0,0.02);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      border-left: 3px solid #FF5E00;
    }
    
    .order-message-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #555;
    }
    
    .order-actions {
      display: flex;
      justify-content: center;
      margin-top: 25px;
    }
    
    /* äºŒç»´ç ä¸Šä¼ åŒºåŸŸ */
    .qr-upload-area {
      width: 100%;
      height: 200px;
      border: 2px dashed rgba(0,0,0,0.15);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.5);
      position: relative;
      overflow: hidden;
      margin-top: 20px;
    }
    
    .qr-upload-area:hover {
      border-color: #FF5E00;
      background: rgba(255,94,0,0.05);
    }
    
    .qr-upload-icon {
      font-size: 40px;
      color: rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }
    
    .qr-upload-text {
      font-size: 14px;
      color: #555;
      text-align: center;
      padding: 0 20px;
    }
    
    .qr-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 10px;
      background: white;
    }
    
    .qr-upload-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
    }
    
    .qr-upload-area:hover .qr-upload-actions {
      display: block;
    }
    
    .qr-upload-remove {
      background: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    .qr-upload-remove:hover {
      background: #ff5e5e;
      color: white;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="navbar-brand">YouTubeå……å€¼ç³»ç»Ÿ</div>
    <a href="/" class="btn btn-primary" style="font-size: 12px; padding: 8px 12px;">
      <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
    </a>
  </div>
  
  <div class="main-container">
    <div class="card">
      <div class="card-header">
        <h2>è®¢å•è¯¦æƒ…</h2>
        <div>
          <span class="order-id">#{{ order.id }}</span>
          <span class="status-badge status-{{ order.status }}">{{ order.status_text }}</span>
        </div>
      </div>
      
      <div class="order-details">
        <div class="order-label">å®¢æˆ·æ˜µç§°</div>
        <div class="order-value">{{ order.customer_name }}</div>
        
        <div class="order-label">å……å€¼å¥—é¤</div>
        <div class="order-value">{{ order.package }}å¤©ï¼ˆÂ¥{{ prices[order.package] }}ï¼‰</div>
        
        <div class="order-label">åˆ›å»ºæ—¶é—´</div>
        <div class="order-value">{{ order.created_at }}</div>
        
        {% if order.paid_at %}
        <div class="order-label">æ”¯ä»˜æ—¶é—´</div>
        <div class="order-value">{{ order.paid_at }}</div>
        {% endif %}
        
        {% if order.confirmed_at %}
        <div class="order-label">ç¡®è®¤æ—¶é—´</div>
        <div class="order-value">{{ order.confirmed_at }}</div>
        {% endif %}
      </div>
      
      <!-- è®¢å•çŠ¶æ€æ—¶é—´çº¿ -->
      <div class="order-status-timeline">
        <div class="timeline-step {% if order.status in ['submitted', 'paid', 'confirmed'] %}completed{% elif order.status in ['failed', 'need_new_qr'] %}failed{% endif %}">
          <div class="timeline-dot">
            <i class="fas fa-check"></i>
          </div>
          <div class="timeline-label">å·²æäº¤</div>
          <div class="timeline-date">{{ order.created_at }}</div>
        </div>
        
        <div class="timeline-step {% if order.status in ['paid', 'confirmed'] %}completed{% elif order.status == 'submitted' %}active{% elif order.status in ['failed', 'need_new_qr'] %}failed{% endif %}">
          <div class="timeline-dot">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="timeline-label">å·²æ”¯ä»˜</div>
          <div class="timeline-date">{{ order.paid_at or '' }}</div>
        </div>
        
        <div class="timeline-step {% if order.status == 'confirmed' %}completed{% elif order.status == 'paid' %}active{% elif order.status in ['failed', 'need_new_qr'] %}failed{% endif %}">
          <div class="timeline-dot">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="timeline-label">å·²ç¡®è®¤</div>
          <div class="timeline-date">{{ order.confirmed_at or '' }}</div>
        </div>
      </div>
      
      {% if order.message %}
      <div class="order-message">
        <div class="order-message-title">
          <i class="fas fa-info-circle"></i> è®¢å•æ¶ˆæ¯
        </div>
        <div>{{ order.message }}</div>
      </div>
      {% endif %}
      
      {% if need_new_qr %}
      <div class="order-message" style="border-left-color: #9b59b6;">
        <div class="order-message-title">
          <i class="fas fa-exclamation-circle"></i> éœ€è¦æ–°äºŒç»´ç 
        </div>
        <div>æ‚¨çš„äºŒç»´ç å·²è¿‡æœŸæˆ–æ— æ³•è¯†åˆ«ï¼Œè¯·ä¸Šä¼ æ–°çš„äºŒç»´ç å›¾ç‰‡ä»¥ç»§ç»­å¤„ç†æ‚¨çš„è®¢å•ã€‚</div>
        
        <form id="update-qr-form">
          <div class="qr-upload-area" id="qr-upload-area">
            <div class="qr-upload-icon">
              <i class="fas fa-qrcode"></i>
            </div>
            <div class="qr-upload-text">
              ç‚¹å‡»ä¸Šä¼ æ–°çš„äºŒç»´ç å›¾ç‰‡ï¼Œæˆ–è€…å°†å›¾ç‰‡æ‹–æ”¾åˆ°æ­¤å¤„<br>
              <small>æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå¯ä»¥ç›´æ¥ç²˜è´´å›¾ç‰‡</small>
            </div>
            <img id="qr-preview" class="qr-preview" style="display: none;">
            <div class="qr-upload-actions">
              <button type="button" class="qr-upload-remove" id="qr-upload-remove">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <input type="file" id="qr-file" style="display: none;" accept="image/*">
          <input type="hidden" name="qr_image_data" id="qr-image-data">
          
          <div class="order-actions">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> æäº¤æ–°äºŒç»´ç 
            </button>
          </div>
        </form>
      </div>
      {% endif %}
      
      {% if order.status == 'failed' %}
      <div class="order-actions">
        <a href="/" class="btn btn-primary">
          <i class="fas fa-redo"></i> åˆ›å»ºæ–°è®¢å•
        </a>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- è‡ªå®šä¹‰è­¦å‘Šæ¡† -->
  <div id="custom-alert" class="custom-alert" style="display: none;">
    <div class="custom-alert-icon">
      <i class="fas fa-info-circle"></i>
    </div>
    <div class="custom-alert-message">æç¤ºä¿¡æ¯</div>
    <div class="custom-alert-close">
      <i class="fas fa-times"></i>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      {% if need_new_qr %}
      // æ–‡ä»¶ä¸Šä¼ å¤„ç†
      const qrUploadArea = document.getElementById('qr-upload-area');
      const qrFile = document.getElementById('qr-file');
      const qrPreview = document.getElementById('qr-preview');
      const qrImageData = document.getElementById('qr-image-data');
      const qrUploadRemove = document.getElementById('qr-upload-remove');
      
      // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
      qrUploadArea.addEventListener('click', function() {
        if (qrPreview.style.display === 'none') {
          qrFile.click();
        }
      });
      
      // æ–‡ä»¶é€‰æ‹©å˜åŒ–å¤„ç†
      qrFile.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            qrPreview.src = e.target.result;
            qrPreview.style.display = 'block';
            qrImageData.value = e.target.result;
          }
          
          reader.readAsDataURL(this.files[0]);
        }
      });
      
      // åˆ é™¤é¢„è§ˆå›¾
      qrUploadRemove.addEventListener('click', function(e) {
        e.stopPropagation();
        qrPreview.src = '';
        qrPreview.style.display = 'none';
        qrImageData.value = '';
        qrFile.value = '';
      });
      
      // æ‹–æ”¾æ–‡ä»¶å¤„ç†
      qrUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.style.borderColor = '#FF5E00';
        this.style.background = 'rgba(255,94,0,0.05)';
      });
      
      qrUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.style.borderColor = 'rgba(0,0,0,0.15)';
        this.style.background = 'rgba(255,255,255,0.5)';
      });
      
      qrUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.style.borderColor = 'rgba(0,0,0,0.15)';
        this.style.background = 'rgba(255,255,255,0.5)';
        
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          const file = e.dataTransfer.files[0];
          if (file.type.match('image.*')) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              qrPreview.src = e.target.result;
              qrPreview.style.display = 'block';
              qrImageData.value = e.target.result;
            }
            
            reader.readAsDataURL(file);
          } else {
            showAlert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶', 'error');
          }
        }
      });
      
      // ç²˜è´´å›¾ç‰‡å¤„ç†
      document.addEventListener('paste', function(e) {
        if (e.clipboardData && e.clipboardData.items) {
          const items = e.clipboardData.items;
          
          for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
              const blob = items[i].getAsFile();
              const reader = new FileReader();
              
              reader.onload = function(e) {
                qrPreview.src = e.target.result;
                qrPreview.style.display = 'block';
                qrImageData.value = e.target.result;
              }
              
              reader.readAsDataURL(blob);
              break;
            }
          }
        }
      });
      
      // è¡¨å•æäº¤å¤„ç†
      const updateQrForm = document.getElementById('update-qr-form');
      
      updateQrForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // éªŒè¯è¡¨å•
        if (!qrImageData.value) {
          showAlert('è¯·ä¸Šä¼ äºŒç»´ç å›¾ç‰‡', 'error');
          return;
        }
        
        // æ”¶é›†è¡¨å•æ•°æ®
        const formData = new FormData();
        formData.append('qr_image_data', qrImageData.value);
        
        // å‘é€è¯·æ±‚
        fetch('/order/{{ order.id }}/update_qr', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showAlert(data.message, 'success');
            
            // 2ç§’ååˆ·æ–°é¡µé¢
            setTimeout(function() {
              window.location.reload();
            }, 2000);
          } else {
            showAlert(data.error, 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('æäº¤äºŒç»´ç æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
        });
      });
      {% endif %}
      
      // æ˜¾ç¤ºè‡ªå®šä¹‰è­¦å‘Šæ¡†
      function showAlert(message, type) {
        const alert = document.getElementById('custom-alert');
        const alertMessage = document.querySelector('.custom-alert-message');
        const alertIcon = document.querySelector('.custom-alert-icon i');
        
        alertMessage.textContent = message;
        
        // è®¾ç½®ç±»å‹
        alert.className = 'custom-alert';
        alert.classList.add(type);
        
        // è®¾ç½®å›¾æ ‡
        switch(type) {
          case 'success':
            alertIcon.className = 'fas fa-check-circle';
            break;
          case 'warning':
            alertIcon.className = 'fas fa-exclamation-circle';
            break;
          case 'error':
            alertIcon.className = 'fas fa-times-circle';
            break;
          default:
            alertIcon.className = 'fas fa-info-circle';
        }
        
        // æ˜¾ç¤ºè­¦å‘Šæ¡†
        alert.style.display = 'flex';
        
        // 3ç§’åè‡ªåŠ¨å…³é—­
        setTimeout(function() {
          alert.style.display = 'none';
        }, 3000);
      }
      
      // å…³é—­è­¦å‘Šæ¡†
      document.querySelector('.custom-alert-close').addEventListener('click', function() {
        document.getElementById('custom-alert').style.display = 'none';
      });
    });
  </script>
</body>
</html> 